apply plugin: 'com.android.library'
apply from: '../configuration.gradle'
apply plugin: 'com.kezong.fat-aar'

def ext = project.ext
def config = ext.configuration

def fatAar = false

buildscript {
    apply from: '../dependencies.gradle'
    addRepos(repositories)
    System.properties['com.android.build.gradle.overrideVersionCheck'] = 'true'
    dependencies {
        classpath deps.android_plugin
        classpath deps.android_maven_plugin
        classpath deps.bintray_plugin
        classpath deps.fat_aar
    }
}

tasks.withType(Javadoc) {
    options.encoding = 'UTF-8'
}


android {
    compileSdkVersion 28

    compileOptions {
        sourceCompatibility config.SOURCE_COMPATIBILITY
        targetCompatibility config.TARGET_COMPATIBILITY
    }

    lintOptions {
        abortOnError false
    }

    defaultConfig {
        testInstrumentationRunner "android.support.test.runner.AndroidJUnitRunner"
        minSdkVersion 21
        targetSdkVersion 28
    }

    packagingOptions {
        exclude 'META-INF/DEPENDENCIES'
        exclude 'META-INF/LICENSE'
        exclude 'META-INF/LICENSE.txt'
        exclude 'META-INF/LICENSE.md'
        exclude 'META-INF/license.txt'
        exclude 'META-INF/NOTICE'
        exclude 'META-INF/NOTICE.txt'
        exclude 'META-INF/notice.txt'
        exclude 'META-INF/LICENSE-notice.md'
        exclude 'META-INF/ASL2.0'
    }

    testOptions {
        unitTests.all {
            useJUnitPlatform()
        }
    }
}

apply from: '../publication_android.gradle'

dependencies {

    if (fatAar) {
        embed fileTree(dir: "$projectDir/src/main/libs", include: ['*.aar'])
        embed deps.bitmark_sdk.api_service
        embed deps.android_support.annotation
        embed deps.android_support.compat
        embed deps.android_support.appcompat
        embed("com.facebook.react:react-native:+") {
            exclude group: 'com.android.support', module: 'support-v4'
        }

        compileOnly deps.bitmark_sdk.api_service
        compileOnly deps.android_support.annotation
        compileOnly deps.android_support.compat
        compileOnly deps.android_support.appcompat
        compileOnly("com.facebook.react:react-native:+") {
            exclude group: 'com.android.support', module: 'support-v4'
        }
    } else {
        implementation fileTree(dir: "$projectDir/src/main/libs", include: ['*.aar'])
        implementation deps.bitmark_sdk.api_service
        implementation deps.android_support.annotation
        implementation deps.android_support.compat
        implementation deps.android_support.appcompat
        implementation("com.facebook.react:react-native:+") {
            exclude group: 'com.android.support', module: 'support-v4'
        }
    }




    testImplementation deps.junit_jupiter.api
    testImplementation deps.junit_jupiter.params
    testImplementation deps.junit_platform.suite_api
    testImplementation deps.junit_platform.runner
    testImplementation deps.junit_jupiter.engine

    androidTestImplementation deps.junit
    androidTestImplementation deps.android_test_runner
    androidTestImplementation deps.java_stream

}
